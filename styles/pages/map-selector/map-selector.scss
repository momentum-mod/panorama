@use '../../config' as *;
@use '../../abstract/mixin';
@use 'sass:map';
@use 'sass:color';

.mapselector {
	$root: &;

	flow-children: none;
	width: 100%;
	height: 100%;

	&__left-container {
		horizontal-align: left;
		// Warning: using percentage widths here cause ugly raster scaling
		width: 820px;
		height: 100%;
		margin-right: 8px;
	}

	&__left {
		horizontal-align: middle;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.3);
		opacity: 1;

		transform: translateX(0);
		@include gallery-transition;

		#{$root}--gallery-mode & {
			transform: translateX(-200px);
			opacity: 0;
		}
	}

	&__left-wrapper {
		flow-children: down;
		height: 100%;
		width: 100%;
		border: 1px solid rgba(255, 255, 255, 0.01);
		box-shadow: 0 0 16px 0 rgba(0, 0, 0, 0.5);
	}

	&__right {
		flow-children: down;
		horizontal-align: right;
		width: 960px;
		height: fill-parent-flow(1);
	}

	&__maps,
	&__playlists {
		flow-children: down;
		padding: 16px;
	}

	&__maps {
		visibility: visible;
		padding-right: 8px;
		width: 100%;
	}

	&__playlists {
		visibility: collapse;
	}

	&__category-contents {
		width: 100%;

		&--playlists {
			#{$root}__maps {
				visibility: collapse;
			}
			#{$root}__playlists {
				visibility: visible;
			}
		}
	}

	&__emptywarning {
		flow-children: down;
		width: 100%;
		height: 100%;
		horizontal-align: center;
		padding: 50px 100px 50px 100px;
		margin-right: 8px;
		background-color: rgba(0, 0, 0, 0.3);

		&--hidden {
			visibility: collapse;
		}
	}

	// Elements are MapEntrys, in mapentry.scss
	&__list {
		flow-children: down;
		// Important note: always ensure a DelayLoadList has a non-zero height, if having 0 items results in 0 height,
		// it'll never repaint itself when items are added.
		height: 100%;
		padding-right: 16px;
		width: 100%;
		overflow: squish scroll;

		& > VerticalScrollBar .ScrollThumb {
			opacity: 1;
		}
	}
}

.mapselector-category-tabs {
	width: 100%;
	flow-children: right;

	&__tab {
		width: fill-parent-flow(1);
		padding: 8px 0;
		transition: background-color 0.1s ease-in-out 0s;

		&:not(:selected) {
			background-color: rgba(0, 0, 0, 0.4);
			&:hover {
				background-color: rgba(0, 0, 0, 0.18);
			}
		}
	}

	&__image {
		vertical-align: center;
		width: 24px;
		height: 24px;
		margin-right: 4px;
	}

	&__text {
		font-size: 22px;
	}
}

.mapselector-header {
	flow-children: right;
	width: 100%;
	padding-right: 8px;

	&__tabs {
		flow-children: right;
		horizontal-align: right;
		vertical-align: bottom;
		border: 0 none;
		border-radius: 4px;
		margin-right: 8px;
	}

	&__tab {
		padding: 2px 8px;
		border-bottom: 1px solid $tab-lower-border-color;

		&:hover {
			border-bottom: 1px solid rgba(255, 255, 255, 0.5);
		}

		&:selected {
			border-bottom: 1px solid rgba(255, 255, 255, 0.8);
		}
	}

	&__search {
		width: fill-parent-flow(1);
		margin-right: 6px;
	}
}

.mapselector-filters {
	$this: &;

	flow-children: down;
	width: 100%;
	padding-right: 8px;
	margin-top: 2px;
	margin-bottom: 8px;

	&__gamemode-button {
		// IMPORTANT: `button` class gives vertical-align: center which is buggy with flow wrapping!!
		vertical-align: top;
		margin-bottom: 4px;
		margin-right: 4px;
	}

	&__text {
		font-size: 20px;
	}

	&__row {
		flow-children: right;
		margin-top: 8px;
		width: 100%;
	}

	&__gamemodes {
		margin-top: 4px;
		margin-bottom: 4px;
		flow-children: right-wrap;

		& > #HorizontalScrollBar {
			height: 2px;
			& > #ScrollThumb {
				opacity: 1;
			}
		}
	}

	&__tiers {
		width: fill-parent-flow(1);
		max-width: 360px;
		flow-children: right;
		margin-right: 24px;
		margin-top: 4px;
	}

	&__tier-label {
		@include mixin.font-styles($use-header: true);
		font-size: 22px;
		margin-right: 8px;
		vertical-align: center;
	}

	&__nstatebutton {
		@include mixin.nstate-button-state('include', 1);
		@include mixin.nstate-button-state('exclude', 2);
	}
}

// TODO: Getting this to align well without magic numbers is extremely difficult, but spacing ends up difference on
// different resolutions. The fill-parent-flow gaps seem to be causing some kind of rounding which differs per res.
$notch-width: 10px;
.mapselector-tier-slider {
	flow-children: none;
	width: 100%;

	&__numbers {
		flow-children: right;
		width: 100%;
		padding-top: 0;
		overflow: noclip;
	}

	&__number {
		@include mixin.font-styles($use-header: false);
		font-weight: bold;
		font-size: 12px;
		text-align: center;
		text-shadow: 0 1px 2px 1 rgba(0, 0, 0, 1);
		width: $notch-width;
		height: 16px;

		&--10 {
			transform: translateX(-4px);
			width: $notch-width + 4px;
			margin-right: -4px;
			text-overflow: noclip;
			overflow: noclip;
		}
	}

	&__gap {
		width: fill-parent-flow(1);
		height: 100%;
	}

	&__slider {
		width: 100%;
		margin-top: 16px;
		padding: 0;

		#SliderTrack,
		#SliderTrackProgress {
			height: 4px;
		}

		#SliderThumb,
		#SliderThumb2 {
			border-radius: 2px;
			width: $notch-width;
			height: $notch-width;
		}
	}
}

.mapselector-leaderboards {
	$root: &;

	width: 100%;
	flow-children: none;
	overflow: noclip;

	transform: translateY(0);
	@include gallery-transition;

	// Hack noclip container to much gallery mode anims work. Noclip on parent breaks y layout.
	&__clipping-hack {
		width: 100%;
		vertical-align: top;
		overflow: noclip;
	}

	.mapselector--gallery-mode & {
		transform: translateY(-200px);
		opacity: 0;
	}

	&__list {
		width: 100%;
		height: fit-children;
		background-color: rgba(0, 0, 0, 0.6);
		padding: 16px;
	}

	&__list-wrapper {
		width: 100%;
		height: fit-children;
		box-shadow: 0 0 16px 0 rgba(0, 0, 0, 0.5);

		visibility: collapse;

		#{$root}--open & {
			visibility: visible;
		}
	}

	&__open-button {
		horizontal-align: right;
		height: 36px;

		#{$root}--open & {
			visibility: collapse;
		}
	}
}

.mapselector-map-info {
	flow-children: down;
	vertical-align: bottom;
	width: 100%;

	&__block {
		flow-children: right;
		width: 100%;

		&-left {
			width: fill-parent-flow(1);
			min-width: 450px;
			margin-right: 8px;
		}

		&-right {
			width: fill-parent-flow(0.5);
			max-width: 290px;
			horizontal-align: left;
		}
	}

	&__content {
		flow-children: right;
		height: 270px;
		width: 100%;
		margin-top: 8px;
	}

	&__action {
		flow-children: none;

		width: fill-parent-flow(1);
		height: 72px;
		max-height: 40px;
	}

	&__favourite {
		width: 40px;
		height: 40px;
		margin: 0 6px;
	}

	&__leaderboard-button {
		box-shadow: fill 0 0 1px 0 rgba(0, 0, 0, 0.8);
	}

	&__big-button {
		width: fill-parent-flow(1);
		height: 40px;
	}

	&__description {
		height: 100%;
		@include mixin.font-styles($use-header: false);
		background-color: rgba(0, 0, 0, 0.5);
	}

	&__description-scroll {
		flow-children: down;
		overflow: squish scroll;
		padding: 12px;
		width: 100%;

		& > VerticalScrollBar {
			width: 4px;
			opacity: 0.4;
		}
	}

	&__description-main-elements {
		flow-children: down;
		// For some reason (maybe a bug?) when a panel has overflow: scroll its children
		// can't be positioned with align. This is a hack to force the See More button to the bottom.
		width: 100%;
		height: fit-children;
		min-height: 210px;
	}

	&__status,
	&__changelog {
		width: 100%;
		flow-children: down;
		visibility: collapse;

		#{$root}--submission & {
			visibility: visible;
		}
	}

	&__status-icon {
		wash-color: #fafafa;
		width: 16px;
		height: 16px;
	}

	&__wrapper {
		flow-children: down;
		width: 100%;
		height: 100%;
		padding: 12px;

		&--unpadded {
		}

		box-shadow: 0 0 16px 0 rgba(0, 0, 0, 0.5);
	}

	&__paragraph {
		width: 100%;
		font-size: 17px;
		text-shadow: 1px 1px 2px 1 rgba(0, 0, 0, 0.8);
	}
}

.mapselector-credits {
	flow-children: right-wrap;
	margin-right: 8px;

	& > HorizontalScrollBar {
		.ScrollThumb {
			transform: translateY(6px);
			max-height: 2px;
		}
	}

	&__text {
		@include mixin.font-styles($use-header: false);
		font-size: 18px;
	}

	&__name {
		transition: color 0s ease-in-out 0s;

		&--steam {
			color: $light-blue;

			transition: color 0.1s ease-in-out 0s;
			&:hover {
				color: color.scale($light-blue, $lightness: 50%);
			}
		}
	}
}

.mapselector-stats {
	height: fill-parent-flow(1);
	width: 100%;
	background-color: rgba(0, 0, 0, 0.6);

	&__container {
		width: 100%;
		height: 100%;
		flow-children: right;
	}

	&__column {
		flow-children: down;
		width: fill-parent-flow(1);
		height: 100%;

		margin-left: 4px;

		&--right {
			margin-left: 12px + 4px;
		}
	}

	&__gap {
		vertical-align: center;
		width: 1px;
		height: 80%;
	}
}

.mapselector-stat {
	flow-children: right;
	height: fill-parent-flow(1);
	width: 100%;
	margin: 6px 0;

	&__icon {
		padding: 2px;
		height: 100%;
		width: height-percentage(100%);
		margin-right: 6px;
		img-shadow: 0 0 3px 1 rgba(0, 0, 0, 1);
	}

	&__text {
		@include mixin.font-styles($use-header: true, $light-header: true);
		font-size: 22px;
		text-overflow: shrink;
		margin-left: 6px;
		text-shadow: 0 1px 3px 2 rgba(0, 0, 0, 0.8);

		transition: opacity 0.1s ease-out 0s;
		opacity: 1;
		.mapselector-stats--loading & {
			opacity: 0;
		}
	}

	&__spinner {
		padding: 2px;
		height: 100%;
		width: height-percentage(100%);
		img-shadow: 0 0 3px 1 rgba(0, 0, 0, 1);
		@include animations.spin-animation;

		transition: opacity 0.1s ease-out 0s;
		opacity: 0;
		.mapselector-stats--loading & {
			opacity: 1;
		}
	}
}

.mapselector-action-button {
	flow-children: none;

	width: 100%;
	height: 100%;

	@include mixin.button-gradient($color: 'blue');

	transition: background-color 0.1s ease-in-out 0s;

	.action-play {
		visibility: collapse;
	}
	.action-download {
		visibility: visible;
	}

	&.playable {
		@include mixin.button-gradient($color: 'green');

		.action-download {
			visibility: collapse;
		}
		.action-play {
			visibility: visible;
		}
	}

	&__typecontainer {
		flow-children: right;
		height: 100%;
		horizontal-align: center;
	}

	&__icon {
		margin-left: 0;
		padding: 6px;
	}

	&__text {
		vertical-align: center;
		font-size: 24px;
		margin-left: 0px;
		margin-right: 10px;
		padding-bottom: 1px;
	}
}
